/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/runtime","@grafana/ui","@grafana/data"],(function(t,e,n,a){return function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(a,o,function(e){return t[e]}.bind(null,o));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=6)}([function(t){t.exports=JSON.parse('{"endpoint":"http://localhost:8080/write","dashboard":"$__dashboard","showDetails":true,"postStart":true,"postHeartbeat":false,"heartbeatInterval":60,"heartbeatAlways":false,"postEnd":false,"flatten":false}')},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=a},function(t,e){function n(t){return t&&t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function a(t){return t}function o(t,e){const o=(e=e||{}).delimiter||".",r=e.maxDepth,i=e.transformKey||a,s={};return function t(a,l,u){u=u||1,Object.keys(a).forEach((function(d){const c=a[d],p=e.safe&&Array.isArray(c),f=Object.prototype.toString.call(c),h=n(c),y="[object Object]"===f||"[object Array]"===f,v=l?l+o+i(d):i(d);if(!p&&!h&&y&&Object.keys(c).length&&(!e.maxDepth||u<r))return t(c,v,u+1);s[v]=c}))}(t),s}t.exports=o,o.flatten=o,o.unflatten=function t(e,r){const i=(r=r||{}).delimiter||".",s=r.overwrite||!1,l=r.transformKey||a,u={};if(n(e)||"[object Object]"!==Object.prototype.toString.call(e))return e;function d(t){const e=Number(t);return isNaN(e)||-1!==t.indexOf(".")||r.object?t:e}return e=Object.keys(e).reduce((function(t,n){const a=Object.prototype.toString.call(e[n]);return!("[object Object]"===a||"[object Array]"===a)||function(t){const e=Object.prototype.toString.call(t),n="[object Array]"===e,a="[object Object]"===e;if(!t)return!0;if(n)return!t.length;if(a)return!Object.keys(t).length}(e[n])?(t[n]=e[n],t):function(t,e,n){return Object.keys(n).reduce((function(e,a){return e[t+i+a]=n[a],e}),e)}(n,t,o(e[n],r))}),{}),Object.keys(e).forEach((function(n){const a=n.split(i).map(l);let o=d(a.shift()),c=d(a[0]),p=u;for(;void 0!==c;){if("__proto__"===o)return;const t=Object.prototype.toString.call(p[o]),e="[object Object]"===t||"[object Array]"===t;if(!s&&!e&&void 0!==p[o])return;(s&&!e||!s&&null==p[o])&&(p[o]="number"!=typeof c||r.object?{}:[]),p=p[o],a.length>0&&(o=d(a.shift()),c=d(a[0]))}p[o]=t(e[n],r)})),u}},function(t,e,n){"use strict";n.r(e);var a=n(4),o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var r=function(){return(r=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var i,s=n(1),l=n.n(s),u=n(3),d=n(5),c=new Uint8Array(16);function p(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(c)}var f=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var h=function(t){return"string"==typeof t&&f.test(t)},y=[],v=0;v<256;++v)y.push((v+256).toString(16).substr(1));var b=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(y[t[e+0]]+y[t[e+1]]+y[t[e+2]]+y[t[e+3]]+"-"+y[t[e+4]]+y[t[e+5]]+"-"+y[t[e+6]]+y[t[e+7]]+"-"+y[t[e+8]]+y[t[e+9]]+"-"+y[t[e+10]]+y[t[e+11]]+y[t[e+12]]+y[t[e+13]]+y[t[e+14]]+y[t[e+15]]).toLowerCase();if(!h(n))throw TypeError("Stringified UUID is invalid");return n};var m=function(t,e,n){var a=(t=t||{}).random||(t.rng||p)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){n=n||0;for(var o=0;o<16;++o)e[n+o]=a[o];return e}return b(a)},g=n(2);function w(t){return"/dashboard/new"===t}function O(t){if(!w(t)){var e=t.split("/");if(e&&e.length>2)return e[2]}return""}function S(t){return Math.floor(t/1e3)}function j(t){try{new URL(t)}catch(t){return!1}return!0}function I(t){var e=t.status.toString();if(!/^(0)|(20[0-4])$/.test(e))throw new Error("Returned status "+e);return t}function P(t){var e=Object(g.getTemplateSrv)();return{server:e.replace(t.server),dashboardName:e.replace(t.dashboard),variables:e.getVariables().map((function(t){var e,n,a=t,o=!1,r=null===(e=null==a?void 0:a.current)||void 0===e?void 0:e.value;return"string"==typeof r&&""!==r?r=[r]:Array.isArray(r)?o=!0:r=[],{name:t.name,label:null!==(n=t.label)&&void 0!==n?n:"",type:t.type,multi:o,values:r}}))}}function x(t,e,n,a,o,r,i,s){var l,u,d,c,p,f,h,y,v,b,m,w,j,I,P,x,E,_,N,A,T,V=S((new Date).getTime()),D=g.config.buildInfo,F={version:null!==(l=D.version)&&void 0!==l?l:"",commit:null!==(u=D.commit)&&void 0!==u?u:"",env:null!==(d=D.env)&&void 0!==d?d:"",edition:null!==(c=D.edition)&&void 0!==c?c:""},H=g.config.licenseInfo,k={hasLicense:null!==(p=H.hasLicense)&&void 0!==p&&p,expiry:null!==(f=H.expiry)&&void 0!==f?f:0,stateInfo:null!==(h=H.stateInfo)&&void 0!==h?h:""},R={hostname:i.hostname,port:i.port,protocol:i.protocol,buildInfo:F,licenseInfo:k},C={name:r,uid:O(i.pathname)},B=S(window.performance.timeOrigin),J=g.config.bootData.user,U={isSignedIn:null!==(y=J.isSignedIn)&&void 0!==y&&y,id:null!==(v=J.id)&&void 0!==v?v:0,login:null!==(b=J.login)&&void 0!==b?b:"",email:null!==(m=J.email)&&void 0!==m?m:"",name:null!==(w=J.name)&&void 0!==w?w:"",lightTheme:null!==(j=J.lightTheme)&&void 0!==j&&j,orgCount:null!==(I=J.orgCount)&&void 0!==I?I:0,orgId:null!==(P=J.orgId)&&void 0!==P?P:0,orgName:null!==(x=J.orgName)&&void 0!==x?x:"",orgRole:null!==(E=J.orgRole)&&void 0!==E?E:"",isGrafanaAdmin:null!==(_=J.isGrafanaAdmin)&&void 0!==_&&_,timezone:null!==(N=J.timezone)&&void 0!==N?N:"",locale:null!==(A=J.locale)&&void 0!==A?A:"",hasEditPermissionInFolders:null!==(T=J.hasEditPermissionInFolders)&&void 0!==T&&T};return{uuid:t,type:e,hasFocus:window.document.hasFocus(),options:n,host:R,dashboard:C,user:U,variables:s,timeRange:a,timeZone:o,timeOrigin:B,time:V}}var E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state=r({uuid:"",location:JSON.parse(JSON.stringify(window.location))},P(e.props.options.analyticsOptions)),e.getPayloadOrFlatPayload=function(t,n){var a=e.props.options.analyticsOptions,o=e.props.timeRange,r=x(t,n,a,{from:o.from.unix(),to:o.to.unix(),raw:o.raw},e.props.timeZone,e.state.dashboardName,e.state.location,e.state.variables);return a.flatten?Object(d.flatten)(r):r},e.sendPayload=function(t){e.setState({error:void 0});var n="";"start"===t?(n=m(),e.setState({uuid:n})):n=e.state.uuid;var a=e.state,o=a.server;if(w(a.location.pathname)){var r=new Error("Dashboard is new and unsaved, and thus no ID was found.");e.setState({error:r})}else if(j(o))fetch(o,{method:"POST",mode:"no-cors",body:JSON.stringify(e.getPayloadOrFlatPayload(n,t)),headers:{"Content-Type":"application/json"},keepalive:!0}).then((function(t){return I(t)})).catch((function(t){e.setState({error:t})}));else{r=new Error('"'+o+'" is not a valid URL.');e.setState({error:r})}},e.sendHeartbeat=function(){(e.props.options.analyticsOptions.heartbeatAlways||window.document.hasFocus())&&e.sendPayload("heartbeat")},e.shouldSetVars=function(t,n,a){return t!==e.state.server||n!==e.state.dashboardName||JSON.stringify(a)!==JSON.stringify(e.state.variables)},e.setHeartbeat=function(){var t=e.state.interval,n=e.props.options.analyticsOptions,a=n.postHeartbeat,o=n.heartbeatInterval,r=1e3*o,i=e.state.intervalFrequency;if(a||void 0===t){if(a&&void 0===t){var s=setInterval(e.sendHeartbeat,r);e.setState({interval:s,intervalFrequency:o})}else if(i&&i!==o){void 0!==t&&clearInterval(t);s=setInterval(e.sendHeartbeat,r);e.setState({interval:s,intervalFrequency:o})}}else clearInterval(t),e.setState({interval:void 0,intervalFrequency:void 0})},e}return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.componentDidMount=function(){this.props.options.analyticsOptions.postStart&&this.sendPayload("start"),this.setHeartbeat()},e.prototype.componentDidUpdate=function(){var t=P(this.props.options.analyticsOptions);this.shouldSetVars(t.server,t.dashboardName,t.variables)&&this.setState(r({},t)),this.setHeartbeat()},e.prototype.componentWillUnmount=function(){this.props.options.analyticsOptions.postEnd&&this.sendPayload("end");var t=this.state.interval;void 0!==t&&clearInterval(t)},e.prototype.render=function(){var t=this,e=this.props,n=e.width,a=e.height,o=this.props.options.analyticsOptions.showDetails,r=this.state,i=r.error,s=r.uuid;if(i&&!o)throw i;return l.a.createElement("div",{style:{position:"relative",overflow:"auto",width:n,height:a}},i&&l.a.createElement("div",{style:{display:"inline-block",textAlign:"center",width:"100%"}},l.a.createElement(u.ErrorWithStack,{title:"analytics-panel error",error:i,errorInfo:null}),l.a.createElement(u.Button,{onClick:function(){return t.sendPayload("start")}},"Retry")),o&&l.a.createElement(u.JSONFormatter,{json:this.getPayloadOrFlatPayload(s,"start")}))},e}(s.PureComponent),_=n(0);n.d(e,"plugin",(function(){return N}));var N=new a.PanelPlugin(E).setPanelOptions((function(t){t.addTextInput({path:"analyticsOptions.server",name:"Endpoint",defaultValue:_.endpoint,description:"The endpoint to which to payloads will be sent."}).addTextInput({path:"analyticsOptions.dashboard",name:"Dashboard",defaultValue:_.dashboard,description:'The name of the dashboard.\n                      Use "$__dashboard" to reference the name of the current dashboard.'}).addBooleanSwitch({path:"analyticsOptions.showDetails",name:"Show Details",description:"Shows the printed JSON object on the panel.\n                      Displays any errors as full error with a retry button.\n                      Enabling this option will not allow Grafana to count errors in meta-analytics.\n                      Note that this option may require you to save the dashboard and reload the page to take effect.",defaultValue:_.showDetails}).addBooleanSwitch({path:"analyticsOptions.postStart",name:"Post Start",description:'Sends a payload with {"type": "start"} when the dashboard is loaded.',defaultValue:_.postStart}).addBooleanSwitch({path:"analyticsOptions.postEnd",name:"Post End",description:'Sends a payload with {"type": "end"} when the dashboard is exited.\n                      Note that this payload will not be sent if the browser or tab is closed.',defaultValue:_.postEnd}).addBooleanSwitch({path:"analyticsOptions.postHeartbeat",name:"Post Heartbeat",description:'Sends a payload with {"type": "heartbeat"} at regular intervals.',defaultValue:_.postHeartbeat}).addNumberInput({path:"analyticsOptions.heartbeatInterval",name:"Heartbeat Interval",description:"Frequency (in seconds) of heartbeat payloads.",defaultValue:_.heartbeatInterval,showIf:function(t){return t.analyticsOptions.postHeartbeat}}).addBooleanSwitch({path:"analyticsOptions.heartbeatAlways",name:"Heartbeat Always",description:"Send heartbeat payloads even when the dashboard is not in focus.\n                      This will continue messages when the dashboard is not visible or when another window has focus.\n                      Leave this option disabled unless you know what you're doing.",defaultValue:_.heartbeatAlways,showIf:function(t){return t.analyticsOptions.postHeartbeat}}).addBooleanSwitch({path:"analyticsOptions.flatten",name:"Flatten",description:"Flattens the payload JSON.\n                      This may make ingestion easier if you use a simple HTTP listener like Telegraf.",defaultValue:_.flatten})}))}])}));
//# sourceMappingURL=module.js.map