/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","app/core/core"],(function(t,e,n,o){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=6)}([function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=o},function(t,e,n){var o=n(5);function r(t){return t}function a(t,e){const n=(e=e||{}).delimiter||".",a=e.maxDepth,i=e.transformKey||r,c={};return function t(r,u,s){s=s||1,Object.keys(r).forEach((function(l){const p=r[l],f=e.safe&&Array.isArray(p),d=Object.prototype.toString.call(p),y=o(p),h="[object Object]"===d||"[object Array]"===d,b=u?u+n+i(l):i(l);if(!f&&!y&&h&&Object.keys(p).length&&(!e.maxDepth||s<a))return t(p,b,s+1);c[b]=p}))}(t),c}t.exports=a,a.flatten=a,a.unflatten=function t(e,n){const i=(n=n||{}).delimiter||".",c=n.overwrite||!1,u=n.transformKey||r,s={};if(o(e)||"[object Object]"!==Object.prototype.toString.call(e))return e;function l(t){const e=Number(t);return isNaN(e)||-1!==t.indexOf(".")||n.object?t:e}return e=Object.keys(e).reduce((t,o)=>{const r=Object.prototype.toString.call(e[o]);return!("[object Object]"===r||"[object Array]"===r)||function(t){const e=Object.prototype.toString.call(t),n="[object Array]"===e,o="[object Object]"===e;if(!t)return!0;if(n)return!t.length;if(o)return!Object.keys(t).length}(e[o])?(t[o]=e[o],t):function(t,e,n){return Object.keys(n).reduce((function(e,o){return e[t+i+o]=n[o],e}),e)}(o,t,a(e[o],n))},{}),Object.keys(e).forEach((function(o){const r=o.split(i).map(u);let a=l(r.shift()),p=l(r[0]),f=s;for(;void 0!==p;){const t=Object.prototype.toString.call(f[a]),e="[object Object]"===t||"[object Array]"===t;if(!c&&!e&&void 0!==f[a])return;(c&&!e||!c&&null==f[a])&&(f[a]="number"!=typeof p||n.object?{}:[]),f=f[a],r.length>0&&(a=l(r.shift()),p=l(r[0]))}f[a]=t(e[o],n)})),s}},function(t,e){t.exports=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},function(t,e,n){"use strict";n.r(e);var o=n(2),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var a=n(0),i=n.n(a),c=n(3);function u(t){try{new URL(t)}catch(t){return!1}return!0}function s(t){return t.replace(/^.+\/\//g,"").replace(/\/.+$/g,"")}function l(){return Math.floor((new Date).getTime()/1e3)}function p(t){var e=t.status.toString();if(!/^(0)|(20[0-4])$/.test(e))throw new Error("Returned status "+e);return t}var f=n(4),d=n(1),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={update:""},e.body=function(){var t=e.props.timeRange,n={from:t.from.unix(),to:t.to.unix()},o={host:s(window.location.href),timeRange:n},r=e.props.options.analyticsOptions,a={options:r,environment:o,context:c.contextSrv.user,time:l()};return r.flatten?Object(f.flatten)(a):a},e.getRequestInit=function(){var t=e.props.options.analyticsOptions.noCors;return e.setState({error:void 0}),{method:"POST",mode:t?"no-cors":"cors",body:JSON.stringify(e.body()),headers:{"Content-Type":"application/json"}}},e.sendInitPayload=function(){var t=e.props.options.analyticsOptions,n=t.server,o=t.postEnd;if(u(n)){var r=fetch(n,e.getRequestInit());o?r.then((function(t){return p(t)})).then((function(t){return t.json()})).then((function(t){return e.setState({update:t.location})})).catch((function(t){e.setState({error:t})})):r.then((function(t){return p(t)})).catch((function(t){e.setState({error:t})}))}else{var a=new Error('"'+n+'" is not a valid URL');e.setState({error:a})}},e.sendFinPayload=function(){var t=e.props.options.analyticsOptions,n=t.server,o=t.postEnd,r=e.state.update;o&&r&&fetch(n+"/"+r,e.getRequestInit()).then((function(t){return p(t)})).catch((function(t){var e="analytics-panel final payload error : "+t.name+" : "+t.message;console.log(e)}))},e}return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.componentDidMount=function(){this.sendInitPayload()},e.prototype.componentWillUnmount=function(){this.sendFinPayload()},e.prototype.render=function(){var t=this,e=this.props,n=e.width,o=e.height,r=this.props.options.analyticsOptions,a=this.state.error;return i.a.createElement("div",{style:{position:"relative",overflow:"auto",width:n,height:o}},a&&i.a.createElement("div",{style:{display:"inline-block",textAlign:"center",width:"100%"}},i.a.createElement(d.ErrorWithStack,{title:"analytics-panel error",error:a,errorInfo:null}),i.a.createElement(d.Button,{onClick:function(){return t.sendInitPayload()}},"Retry")),!r.hidden&&i.a.createElement(d.JSONFormatter,{json:this.body()}))},e}(a.PureComponent);n.d(e,"plugin",(function(){return b}));var h=window.location.href,b=new o.PanelPlugin(y).setPanelOptions((function(t){t.addTextInput({path:"analyticsOptions.server",name:"Endpoint",defaultValue:"https://localhost:8080/telegraf",description:"Location to POST data on panel load."}).addTextInput({path:"analyticsOptions.key",name:"Dashboard ID",defaultValue:h.replace(/^.+\/d\//g,"").replace(/\/.+$/g,""),description:"Unique value to identify the dashboard."}).addTextInput({path:"analyticsOptions.description",name:"Dashboard Description",defaultValue:h.replace(/^.+\/d\/.+\//g,"").replace(/\?.+$/g,""),description:"Description of the dashboard."}).addBooleanSwitch({path:"analyticsOptions.hidden",name:"Hide JSON",description:"Hides the printed JSON object on the panel.",defaultValue:!1}).addBooleanSwitch({path:"analyticsOptions.noCors",name:"No CORS",description:"Sets request mode to no-cors.",defaultValue:!1}).addBooleanSwitch({path:"analyticsOptions.postEnd",name:"Post End",description:"Sends a second request when the panel is unloaded. Disable if you are using Telegraf.",defaultValue:!1}).addBooleanSwitch({path:"analyticsOptions.flatten",name:"Flatten",description:"Flattens the payload JSON. Enable if you are using Telegraf.",defaultValue:!0})}))}])}));
//# sourceMappingURL=module.js.map